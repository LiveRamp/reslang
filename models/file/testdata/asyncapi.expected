asyncapi: 2.0.0
info:
  title: API for modeling directories and files
  description: This is a simple API for manipulating files
  version: 1.0.0
servers:
  production:
    url: 'pubsub.liveramp.com:{port}'
    protocol: Google Cloud Pub/Sub
    description: LiveRamp Production pubsub instance
    variables:
      port:
        description: Secure connection (TLS) is available through port 8883
        default: '1883'
defaultContentType: application/json
channels:
  topics/file_v1-directory-file:
    description: This models a file in a directory
    subscribe:
      summary: 'REST: Directory::File'
      operationId: 'Directory::File'
      message:
        $ref: '#/components/messages/DirectoryFile'
  topics/file_v1-directory-delete-request:
    description: This models a long running request
    subscribe:
      summary: 'REST: DirectoryDeleteRequest'
      operationId: DirectoryDeleteRequest
      message:
        $ref: '#/components/messages/DirectoryDeleteRequest'
  topics/file_v1-directory-delete-incomplete:
    description: 'If a deletion is corrupted, we generate this event'
    subscribe:
      summary: 'Adhoc: DirectoryDeleteIncomplete'
      operationId: DirectoryDeleteIncomplete
      message:
        $ref: '#/components/messages/DirectoryDeleteIncomplete'
components:
  messages:
    DirectoryFile:
      name: DirectoryFile
      title: DirectoryFile
      summary: This models a file in a directory
      contentType: application/json
      traits:
        - $ref: '#/components/messageTraits/RestHeader'
      payload:
        $ref: '#/components/schemas/DirectoryFileOutput'
    DirectoryDeleteRequest:
      name: DirectoryDeleteRequest
      title: DirectoryDeleteRequest
      summary: This models a long running request
      contentType: application/json
      traits:
        - $ref: '#/components/messageTraits/RestHeader'
      payload:
        $ref: '#/components/schemas/DirectoryDeleteRequestOutput'
    DirectoryDeleteIncomplete:
      name: DirectoryDeleteIncomplete
      title: DirectoryDeleteIncomplete
      summary: 'If a deletion is corrupted, we generate this event'
      contentType: application/json
      traits:
        - $ref: '#/components/messageTraits/DirectoryDeleteIncompleteHeader'
      payload:
        $ref: '#/components/schemas/DirectoryDeleteIncomplete'
  schemas:
    DirectoryFileOutput:
      type: object
      properties:
        id:
          type: integer
          format: int32
        name:
          type: string
        url:
          type: string
        fileTypeId:
          type: string
          description: Link to FileType resource via its id
      required:
        - id
        - name
        - url
        - fileTypeId
      description: This models a file in a directory
    DirectoryDeleteRequestOutput:
      type: object
      properties:
        id:
          type: integer
          format: int32
        directoryId:
          type: string
          format: uuid
          example: 123e4567-e89b-12d3-a456-426655440000
          description: Link to Directory resource via its id
      required:
        - id
        - directoryId
      description: This models a long running request
    DirectoryDeleteIncompleteHeader:
      type: object
      properties:
        timeOfFailure:
          type: string
          format: ISO8601 UTC date-time
          example: '2019-04-13T03:35:34Z'
      required:
        - timeOfFailure
      description: 'If a deletion is corrupted, we generate this event'
    DirectoryDeleteIncomplete:
      type: object
      properties:
        directory:
          type: string
          format: uuid
          example: 123e4567-e89b-12d3-a456-426655440000
          description: Link to Directory resource via its id
        corrupted:
          type: boolean
      required:
        - directory
        - corrupted
      description: 'If a deletion is corrupted, we generate this event'
    VerbEnum:
      type: string
      enum:
        - POST
        - PUT
        - PATCH
        - GET
        - MULTIGET
        - DELETE
  messageTraits:
    RestHeader:
      headers:
        type: object
        properties:
          verb:
            description: ''
            $ref: '#/components/schemas/VerbEnum'
          location:
            description: ''
            type: string
            format: url
            example: 'https://www.domain.com (url)'
          ids:
            description: ''
            items:
              type: string
            type: array
        required:
          - verb
          - location
          - ids
    DirectoryDeleteIncompleteHeader:
      headers:
        type: object
        properties:
          timeOfFailure:
            type: string
            format: ISO8601 UTC date-time
            example: '2019-04-13T03:35:34Z'
        required:
          - timeOfFailure
        description: 'If a deletion is corrupted, we generate this event'

